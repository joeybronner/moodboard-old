<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Moodboard</title>
  <meta name="description" content="Moodboard">
  <meta name="author" content="Joey Bronner">
  <link rel="stylesheet" href="bower_components/material-design-lite/material.min.css">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/mystyle.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <script src="bower_components/material-design-lite/material.min.js"></script>
</head>
<body>
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header mdl-layout--fixed-tabs">
    <header class="mdl-layout__header">
      <div class="mdl-layout__header-row">
        <span class="mdl-layout-title">Moodboard</span>
        <div class="mdl-layout-spacer"></div>
        <nav class="mdl-navigation mdl-layout--large-screen-only">
          <a class="mdl-badge" data-badge="4" href="">Mood</a>
        </nav>
      </div>
    </header>
    <div class="mdl-layout__drawer">
      <span class="mdl-layout-title">Menu</span>
      <nav class="mdl-navigation">
        <a class="mdl-navigation__link" href="#home">Mon Moodboard</a>
        <a class="mdl-navigation__link" href="#resume">Amis</a>
        <a class="mdl-navigation__link" href="#contact">Au hasard</a>
        <a class="mdl-navigation__link" href="">Apparence</a>
      </nav>
    </div>
    <main class="mdl-layout__content">
      <section class="mdl-layout__tab-panel is-active" id="home">
        <div class="page-content">
          <svg xmlns="http://www.w3.org/2000/svg" 
           xmlns:xlink="http://www.w3.org/1999/xlink"
           xmlns:svg="http://www.w3.org/2000/svg"
           id="canvas"
           onload="doload()">

            <script type="text/javascript"><![CDATA[
                const SVG = "http://www.w3.org/2000/svg";
                const XLINK = "http://www.w3.org/1999/xlink";
                const hotspot = "rgba(0,200,200,0.3)";
                var r2d = 360.0 / (2.0 * Math.PI);
                var gCanvas = null;
                var currentTransform = null;

                function doload() {
                    var images = [ "https://pbs.twimg.com/media/CNSG57zW8AABQH_.jpg",
                               "https://pbs.twimg.com/media/CLhAKpNWwAA22RA.jpg",
                               "https://pbs.twimg.com/media/B8rAcjqCcAEf3CB.jpg",
                               "https://pbs.twimg.com/media/B8lWafPCYAIvQgD.jpg",
                               "https://pbs.twimg.com/media/B0OesVfCIAMOC4H.jpg",
                               "https://pbs.twimg.com/media/BzRvS_vIIAAuYH5.jpg",
                               "https://pbs.twimg.com/media/By5BjR5CQAERE3z.jpg",
                               "https://pbs.twimg.com/media/BvzPgsqCAAEkYhr.jpg",
                               "https://pbs.twimg.com/media/B6iK8LSIYAAk_oF.jpg" ];

                    // Load the images in the background, and only add them once they're
                    // loaded (and, presumably, cached by the broser)
                    for (var k = 0; k < images.length; k++) {
                        var img = new Image();

                        // do some hackyness here to get the correct variables
                        // to the function
                        img.onload = function(k, url) { return function() {
                                var g = addImage(url, 1.0);
                                g.style.opacity = 1.0;
                                g.vTranslate = [100 + Math.random() * 300 + (k%3) * 250,
                                                100 + Math.random() * 300 + (k/3) * 280];
                                var c = 0.25 + (Math.random() * .25);
                                g.vScale = c; // 0.25; // 0.001;
                                g.vRotate = (Math.random() * 40) - 20;

                                g.setAttribute("transform", "translate(" + g.vTranslate[0] + "," + g.vTranslate[1] + ") " +
                                   "scale(" + g.vScale + "," + g.vScale + ") " +
                                   "rotate(" + g.vRotate + ") ");
                                rampOpacityUp(g);
                            }
                        } (k, images[k]);

                        img.src = images[k];
                    }

                    gCanvas = document.getElementById("canvas");
                    gCanvas.addEventListener("mousemove", onMouseMove, false);
                    gCanvas.addEventListener("mouseup", onMouseUp, false);
                    document.getElementById("background-rect").addEventListener("mousemove", onMouseMove, false);
                    document.getElementById("background-rect").addEventListener("mouseup", onMouseUp, false);
                }

                // convenience function to set X, Y, width, and height attributes
                function svgSetXYWH(el, x, y, w, h) {
                    el.setAttribute("x", x);
                    el.setAttribute("y", y);
                    el.setAttribute("width", w);
                    el.setAttribute("height", h);
                }


                function startTransform(ev, group, what) {
                    // ignore if something else is already going on
                    if (currentTransform != null)
                        return;

                    group.parentNode.removeChild(group);
                    gCanvas.appendChild(group);

                    currentTransform = { what: what, g: group,
                                         s: group.vScale, r: group.vRotate, t: group.vTranslate,
                                         x: ev.clientX, y: ev.clientY };
                    rampOpacityDown(currentTransform.g);
                }

                // create a new clickable rect [x,y,w,h] with the givenfill/stroke
                // with the given handler on mouse down
                function newClickableRect(group, id, x, y, w, h, fill, stroke) {
                    var p = document.createElementNS(SVG, "rect");
                    p.setAttribute("id", id);
                    svgSetXYWH(p, x, y, w, h);
                    p.setAttribute("rx", 30);
                    p.setAttribute("ry", 30);
                    p.setAttribute("fill", fill);
                    //p.setAttribute("stroke", stroke);
                    //p.setAttribute("stroke-width", 10);
                    p.addEventListener("mousedown", function (evt) { var g=group;  return startTransform(evt,g,1); }, false);
                    return p;
                }

                // create all the elements for the given image URL.
                // this includes the toplevel group, the image itself,
                // and the clickable hotspots used for rotating the image.
                var nextImageId = 0;
                function addImage(url, initOpacity) {
                    var imgw = 1000;
                    var imgh = 700;

                    var id = nextImageId++;
                    var s = "image" + id;
                    var g = document.createElementNS(SVG, "g");
                    g.setAttribute("id", s);

                    if (initOpacity != null)
                        g.style.opacity = initOpacity;

                    var image = document.createElementNS(SVG, "image");
                    image.setAttribute("id", s+"-img");
                    svgSetXYWH(image, -imgw/2, -imgh/2, imgw, imgh);
                    image.setAttribute("preserveAspectRatio", "xMinYMin slice");
                    image.setAttributeNS(XLINK, "href", url);
                    g.appendChild(image);

                    var rect = document.createElementNS(SVG, "rect");
                    rect.setAttribute("id", s+"-border");
                    svgSetXYWH(rect, -imgw/2, -imgh/2, imgw, imgh);
                    rect.setAttribute("stroke", "black");
                    rect.setAttribute("rx", "10");
                    rect.setAttribute("ry", "10");
                    rect.setAttribute("stroke-width", "20");
                    rect.setAttribute("fill", "none");

                    g.appendChild(rect);

                    var g2 = document.createElementNS(SVG, "g");
                    g2.setAttribute("id", s+"-overlay");
                    g2.setAttribute("class", "image-overlay");
                    g2.setAttribute("style", "visibility: hidden");

                    var rsz = 200;

                    g2.appendChild(newClickableRect(g, s+"-tl", -imgw/2, -imgh/2, rsz, rsz, hotspot, "rgba(100,100,100,0.5)"));
                    g2.appendChild(newClickableRect(g, s+"-tr", imgw/2-rsz, -imgh/2, rsz, rsz,hotspot, "rgba(100,100,100,0.5)"));
                    g2.appendChild(newClickableRect(g, s+"-br", imgw/2-rsz, imgh/2-rsz, rsz, rsz, hotspot, "rgba(100,100,100,0.5)"));
                    g2.appendChild(newClickableRect(g, s+"-bl", -imgw/2, imgh/2-rsz, rsz, rsz, hotspot, "rgba(100,100,100,0.5)"));

                    g.appendChild(g2);
                    g.addEventListener("mouseover", function (evt) { var o=g2; o.style.visibility = "visible";}, false);
                    g.addEventListener("mouseout", function (evt) { var o=g2; o.style.visibility = "hidden";}, false);
                    g.addEventListener("mousedown", function (evt) { var gr=g; return startTransform(evt, gr, 0); }, false);

                    gCanvas.appendChild(g);

                    return g;
                }

                function onMouseUp(ev) {
                    if (currentTransform)
                        rampOpacityUp(currentTransform.g);
                    currentTransform = null;
                }

                function onMouseMove(ev) {
                    if (!("currentTransform" in window) ||
                        currentTransform == null)
                        return;

                    var ex = ev.clientX;
                    var ey = ev.clientY;
                    var g = currentTransform.g;
                    var pos = g.vTranslate;

                    if (currentTransform.what == 1) {
                        var lastAngle = Math.atan2(currentTransform.y - pos[1],
                                                   currentTransform.x - pos[0]) * r2d;
                        var curAngle = Math.atan2(ey - pos[1],
                                                  ex - pos[0]) * r2d;

                        g.vRotate += (curAngle - lastAngle);

                        var lastLen = Math.sqrt(Math.pow(currentTransform.y - pos[1], 2) +
                                                Math.pow(currentTransform.x - pos[0], 2));
                        var curLen = Math.sqrt(Math.pow(ey - pos[1], 2) +
                                               Math.pow(ex - pos[0], 2));

                        g.vScale = g.vScale * (curLen / lastLen);

                    } else {
                        var xd = ev.clientX - currentTransform.x;
                        var yd = ev.clientY - currentTransform.y;

                        g.vTranslate = [ pos[0] + xd, pos[1] + yd ];
                    }

                    currentTransform.x = ex;
                    currentTransform.y = ey;

                    g.setAttribute("transform", "translate(" + g.vTranslate[0] + "," + g.vTranslate[1] + ") " +
                                   "scale(" + g.vScale + "," + g.vScale + ") " +
                                   "rotate(" + g.vRotate + ") ");

                }

                function rampOpacityDown(g) {
                    g.style.opacity = 1.0;
                    var rampFunc = function () {
                        var o = parseFloat(g.style.opacity) - 0.05;
                        g.style.opacity = o;
                        if (o > 0.7)
                            setTimeout(rampFunc, 10);
                    }
                    rampFunc();
                }

                function rampOpacityUp(g) {
                    g.style.opacity = 0.7;
                    var rampFunc = function () {
                        var o = parseFloat(g.style.opacity) + 0.05;
                        g.style.opacity = o;
                        if (o < 1.0)
                            setTimeout(rampFunc, 10);
                    }
                    rampFunc();
                }
            ]]></script>

            <rect id="background-rect" x="0%" y="0%" width="100%" height="100%" fill="#F5F5F5"/>

          </svg>
        </div>
      </section>
      <section class="mdl-layout__tab-panel" id="resume">
        <div class="page-content">
          <div class="mdl-grid mdl-grid--no-spacing">
            Rien pour le moment.
          </div>
        </div>
      </section>
      <section class="mdl-layout__tab-panel" id="contact">
        <div class="page-content">
          <div class="mdl-grid">
            Rien pour le moment.
          </div>
        </div>
      </section>
    </main>
  </div>
</body>
</html>